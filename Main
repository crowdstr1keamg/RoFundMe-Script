--// CONFIG
local PLACE_ID = 137532437639931
local COUNTDOWN_TIME = 900 
local ANTI_AFK_INTERVAL = 300
local WEBHOOK_URL = "https://discord.com/api/webhooks/1460256968332804291/h4SXIYVAhKsNgfnVJIgC5NPZd2VZ2b1w_xHXEBEl9jEYzXOivretwzaWzp5Rfbfq8Su2"

--// SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")
local MarketplaceService = game:GetService("MarketplaceService")
local Stats = game:GetService("Stats")

local player = Players.LocalPlayer
local httpRequest = request or http_request or (syn and syn.request)

--// SAFETY
if game.PlaceId ~= PLACE_ID then return end

--// UI MENU CREATION
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "AutoBoothMenu"
local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 200, 0, 100)
mainFrame.Position = UDim2.new(0.05, 0, 0.05, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0.4, 0)
title.Text = "Auto Booth Active"
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundTransparency = 1

local statusLabel = Instance.new("TextLabel", mainFrame)
statusLabel.Size = UDim2.new(1, 0, 0.6, 0)
statusLabel.Position = UDim2.new(0, 0, 0.4, 0)
statusLabel.Text = "Initializing..."
statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
statusLabel.BackgroundTransparency = 1

--// ENHANCED WEBHOOK
local function sendWebhook(title, desc, color)
    if not httpRequest then return end
    local fps = math.floor(workspace:GetRealPhysicsFPS())
    local ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
    
    pcall(function()
        httpRequest({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({
                embeds = {{
                    title = title,
                    description = desc,
                    color = color or 65535,
                    fields = {
                        {name = "Server Info", value = "Ping: "..ping.."ms | FPS: "..fps, inline = true},
                        {name = "Account Age", value = player.AccountAge.." days", inline = true}
                    },
                    footer = { text = "JobId: "..game.JobId },
                    timestamp = DateTime.now():ToIsoDate()
                }}
            })
        })
    end)
end

--// LEADERSTATS
local ls = player:WaitForChild("leaderstats", 15)
local Raised = ls and ls:FindFirstChild("Raised")
local Donated = ls and ls:FindFirstChild("Donated")

--// CLAIM LOGIC FIX
local function claimBooth(booth)
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end

    -- Target ProxPart specifically
    local proxPart = booth:FindFirstChild("ProxPart", true)
    if not proxPart then return false end

    -- Move to part
    hrp.CFrame = proxPart.CFrame + Vector3.new(0, 3, 0)
    task.wait(0.5)

    local prompt = proxPart:FindFirstChildOfClass("ProximityPrompt")
    if not prompt then return false end

    -- Correctly fire prompt with HoldDuration support
    fireproximityprompt(prompt)
    task.wait(1.5) -- Wait for the 1 second hold duration + buffer

    -- VERIFICATION: Check if actually claimed
    local claimedVal = booth:FindFirstChild("ClaimedName")
    if claimedVal and (claimedVal.Value == player.Name or claimedVal.Value == player.DisplayName) then
        statusLabel.Text = "Booth Claimed!"
        sendWebhook("âœ… Booth Claimed", "Successfully claimed: "..booth.Name.."\nTotal Raised: "..Raised.Value, 5025616)
        return true
    end

    return false
end

--// FIND BOOTH
local function findBooth()
    local stands = workspace:WaitForChild("Stands", 10)
    for _, booth in ipairs(stands:GetChildren()) do
        local claimed = booth:FindFirstChild("ClaimedName")
        if claimed and claimed.Value == "" then
            -- Additional check for VIP/Robux
            local isVip = booth:FindFirstChild("Robux", true) or booth:FindFirstChild("VIP", true)
            if not isVip then return booth end
        end
    end
    return nil
end

--// MAIN LOOP
task.spawn(function()
    statusLabel.Text = "Finding Booth..."
    task.wait(2)
    
    local booth = findBooth()
    if not booth then
        sendWebhook("âŒ Error", "No unclaimed booths found. Hopping...", 16711680)
        TeleportService:Teleport(game.PlaceId, player)
        return
    end

    if claimBooth(booth) then
        local lastRaised = Raised.Value
        while task.wait(1) do
            local timeLeft = COUNTDOWN_TIME
            -- Inner countdown loop
            for i = COUNTDOWN_TIME, 0, -1 do
                statusLabel.Text = "Waiting: " .. i .. "s"
                task.wait(1)
                if Raised.Value > lastRaised then
                    sendWebhook("ðŸ’° Donation!", "Received: "..(Raised.Value - lastRaised).."\nNew Total: "..Raised.Value, 16776960)
                    lastRaised = Raised.Value
                    break -- Reset timer on donation
                end
                if i == 0 then
                    sendWebhook("ðŸ”ƒ Server Hopping", "No donations for 15 mins.", 3447003)
                    TeleportService:Teleport(game.PlaceId, player)
                end
            end
        end
    else
        statusLabel.Text = "Claim Failed. Hopping..."
        task.wait(2)
        TeleportService:Teleport(game.PlaceId, player)
    end
end)

--// ANTI-AFK
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)
