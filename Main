--// CONFIG
local PLACE_ID = 137532437639931
local COUNTDOWN_TIME = 900 
local ANTI_AFK_INTERVAL = 300
local WEBHOOK_URL = "YOUR_WEBHOOK_HERE"

--// SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")
local TextChatService = game:GetService("TextChatService")

local player = Players.LocalPlayer
local httpRequest = request or http_request or (syn and syn.request)

--// DATA HELPERS
local function getGoals()
    local goalData = ""
    local goalsFolder = player:FindFirstChild("Goals")
    if goalsFolder then
        for i = 1, 3 do
            local folder = goalsFolder:FindFirstChild("Goal"..i)
            if folder then
                local exists = folder:FindFirstChild("Goal"..i.."Exist")
                if exists and exists.Value == true then
                    local name = folder:FindFirstChild("Goal"..i.."Name") and folder["Goal"..i.."Name"].Value or "Goal"
                    local raised = folder:FindFirstChild("Goal"..i.."Raised") and folder["Goal"..i.."Raised"].Value or 0
                    local max = folder:FindFirstChild("Goal"..i.."Max") and folder["Goal"..i.."Max"].Value or 0
                    goalData = goalData .. string.format("üéØ **%s**: %d/%d\n", name, raised, max)
                end
            end
        end
    end
    return goalData ~= "" and goalData or "No active goals."
end

local function getBoothText()
    local goalsFolder = player:FindFirstChild("Goals")
    local bText = goalsFolder and goalsFolder:FindFirstChild("BoothText")
    return bText and bText.Value or "No booth text set."
end

--// ENHANCED WEBHOOK
local function sendEnhancedWebhook(title, description, color)
    if not httpRequest then return end
    
    local embed = {
        ["title"] = title,
        ["description"] = description,
        ["color"] = color or 65535,
        ["fields"] = {
            {["name"] = "üë§ User", ["value"] = string.format("`%s` (%d)", player.Name, player.UserId), ["inline"] = true},
            {["name"] = "üìà Stats", ["value"] = string.format("Raised: %d\nDonated: %d", player.leaderstats.Raised.Value, player.leaderstats.Donated.Value), ["inline"] = true},
            {["name"] = "üìú Booth Text", ["value"] = "```" .. getBoothText() .. "```", ["inline"] = false},
            {["name"] = "üöÄ Goal Progress", ["value"] = getGoals(), ["inline"] = false}
        },
        ["footer"] = {["text"] = "JobId: " .. game.JobId},
        ["timestamp"] = DateTime.now():ToIsoDate()
    }

    pcall(function()
        httpRequest({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({embeds = {embed}})
        })
    end)
end

--// CHAT FUNCTION (Fix for modern Roblox)
local function say(msg)
    if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
        if channel then channel:SendAsync(msg) end
    else
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
    end
end

--// CLAIM & POSITION
local function claimAndOccupy(booth)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    
    -- Find the prompt part
    local proxPart = booth:FindFirstChild("ProxPart", true)
    if not proxPart then return false end

    -- Teleport to the prompt to claim
    hrp.CFrame = proxPart.CFrame
    task.wait(0.5)
    
    local prompt = proxPart:FindFirstChildOfClass("ProximityPrompt")
    if prompt then
        fireproximityprompt(prompt)
        task.wait(1.5)
    end

    -- Verification check
    local claimedVal = booth:FindFirstChild("ClaimedName")
    if claimedVal and (claimedVal.Value == player.Name or claimedVal.Value == player.DisplayName) then
        -- Move INSIDE (offset to be behind the counter)
        hrp.CFrame = proxPart.CFrame * CFrame.new(0, 0, 2.5) 
        task.wait(0.5)
        Players:Chat("/e dance2")
        return true
    end
    return false
end

--// MAIN EXECUTION
task.spawn(function()
    task.wait(2)
    sendEnhancedWebhook("üü¢ Script Loaded", "Searching for a booth...", 3066993)

    local stands = workspace:WaitForChild("Stands", 10)
    local myBooth = nil

    -- Find an empty booth
    for _, b in ipairs(stands:GetChildren()) do
        local cn = b:FindFirstChild("ClaimedName")
        if cn and cn.Value == "" then
            myBooth = b
            break
        end
    end

    if myBooth and claimAndOccupy(myBooth) then
        sendEnhancedWebhook("‚úÖ Booth Secured", "Standing inside and dancing.", 3066993)
        
        local lastRaised = player.leaderstats.Raised.Value
        local timer = 0

        while true do
            task.wait(1)
            timer = timer + 1

            if player.leaderstats.Raised.Value > lastRaised then
                local gained = player.leaderstats.Raised.Value - lastRaised
                say("Thank you so much for the " .. gained .. " Robux! You're awesome!")
                sendEnhancedWebhook("üí∞ NEW DONATION", "Just received **" .. gained .. "** Robux!", 16776960)
                
                lastRaised = player.leaderstats.Raised.Value
                timer = 0 -- Reset countdown
                task.wait(1)
                Players:Chat("/e dance2") -- Resume dance
            end

            if timer >= COUNTDOWN_TIME then
                sendEnhancedWebhook("üîÉ Server Hopping", "No donations for 15 minutes.", 15105570)
                TeleportService:Teleport(game.PlaceId, player)
                break
            end
        end
    else
        sendEnhancedWebhook("‚ùå Failure", "Couldn't find or claim a booth. Hopping...", 15158332)
        task.wait(2)
        TeleportService:Teleport(game.PlaceId, player)
    end
end)

--// ANTI-AFK
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)
