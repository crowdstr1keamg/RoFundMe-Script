--[[
    ðŸ’Ž GEMINI PRO | AUTO-BOOTH SYSTEM (RoFundMe)
    Version: 3.0 (Ultimate Build)
    Features: Premium UI, Fixed Webhook, No Rotation, Anti-AFK.
]]

--// CONFIGURATION
local CONFIG = {
    Webhook = "https://discord.com/api/webhooks/1460256968332804291/h4SXIYVAhKsNgfnVJIgC5NPZd2VZ2b1w_xHXEBEl9jEYzXOivretwzaWzp5Rfbfq8Su2", 
    PlaceID = 137532437639931,
    Countdown = 900, -- 15 Minutes
    LowGraphics = true,
    RejoinEnabled = true,
    Messages = {
        "Thank you so much for the %d Robux!",
        "Legend! Thanks for the %d!",
        "I really appreciate the %d Robux donation!",
        "Whoa! %d! You're the best!"
    }
}

--// SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")

--// VARIABLES
local player = Players.LocalPlayer
local sessionRaised = 0
local startTime = os.time()
local lastRaised = 0
local hopTimer = CONFIG.Countdown
local httpRequest = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
local executor = (identifyexecutor and identifyexecutor()) or "Unknown"

--// UI SYSTEM (PREMIUM MENU)
local sg = Instance.new("ScreenGui", player.PlayerGui)
sg.Name = "GeminiMenu"

local main = Instance.new("Frame", sg)
main.Size = UDim2.new(0, 220, 0, 130)
main.Position = UDim2.new(1, -230, 1, -150)
main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
main.BorderSizePixel = 0

local corner = Instance.new("UICorner", main)
corner.CornerRadius = UDim.new(0, 8)

local stroke = Instance.new("UIStroke", main)
stroke.Color = Color3.fromRGB(0, 170, 255)
stroke.Thickness = 2

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "ðŸ’Ž GEMINI PRO V3"
title.TextColor3 = Color3.fromRGB(0, 170, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 16

local function createLabel(text, pos)
    local l = Instance.new("TextLabel", main)
    l.Size = UDim2.new(1, -20, 0, 20)
    l.Position = pos
    l.BackgroundTransparency = 1
    l.Text = text
    l.TextColor3 = Color3.new(1, 1, 1)
    l.Font = Enum.Font.GothamMedium
    l.TextSize = 14
    l.TextXAlignment = Enum.TextXAlignment.Left
    return l
end

local statusLabel = createLabel("Status: Initializing...", UDim2.new(0, 10, 0, 40))
local raisedLabel = createLabel("Session Raised: 0", UDim2.new(0, 10, 0, 60))
local uptimeLabel = createLabel("Uptime: 00:00", UDim2.new(0, 10, 0, 80))
local timerLabel = createLabel("Next Hop: 15:00", UDim2.new(0, 10, 0, 100))

--// WEBHOOK DISPATCHER
local function sendRichWebhook(type, color, details)
    if not httpRequest or CONFIG.Webhook == "YOUR_WEBHOOK_HERE" or CONFIG.Webhook == "" then return end
    
    local uptime = os.time() - startTime
    local h, m = math.floor(uptime/3600), math.floor((uptime%3600)/60)
    
    local payload = {
        ["embeds"] = {{ -- Wrapped in array for Discord fix
            ["title"] = "ðŸ’Ž Gemini Pro | " .. type,
            ["color"] = color,
            ["fields"] = {
                {["name"] = "ðŸ‘¤ Player", ["value"] = "`" .. player.Name .. "`", ["inline"] = true},
                {["name"] = "ðŸ“Š Session", ["value"] = "Raised: **" .. sessionRaised .. "**", ["inline"] = true},
                {["name"] = "â±ï¸ Uptime", ["value"] = string.format("`%dh %dm`", h, m), ["inline"] = true}
            },
            ["footer"] = {["text"] = "Executor: " .. executor},
            ["timestamp"] = DateTime.now():ToIsoDate()
        }}
    }
    
    if details then table.insert(payload.embeds[1].fields, {["name"] = "â„¹ï¸ Details", ["value"] = details, ["inline"] = false}) end

    pcall(function()
        httpRequest({
            Url = CONFIG.Webhook,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode(payload)
        })
    end)
end

--// UTILITIES
local function serverHop()
    statusLabel.Text = "Status: Server Hopping..."
    sendRichWebhook("Server Hopping", 15105570, "Reason: Limit reached or no booths.")
    task.wait(1)
    TeleportService:Teleport(CONFIG.PlaceID, player)
end

local function say(msg)
    if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
        if channel then channel:SendAsync(msg) end
    else
        ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
    end
end

--// CLAIM LOGIC
local function claimAndPark()
    statusLabel.Text = "Status: Finding Booth..."
    local stands = workspace:FindFirstChild("Stands") or workspace:FindFirstChild("Booths")
    if not stands then return false end

    for _, booth in ipairs(stands:GetChildren()) do
        local claimed = booth:FindFirstChild("ClaimedName")
        if claimed and (claimed.Value == "" or claimed.Value == nil) then
            local pPart = booth:FindFirstChild("ProxPart", true)
            local prompt = pPart and pPart:FindFirstChildOfClass("ProximityPrompt")
            
            if prompt and player.Character then
                local hrp = player.Character:WaitForChild("HumanoidRootPart")
                hrp.CFrame = pPart.CFrame -- Moved directly to the prompt
                task.wait(0.5)
                fireproximityprompt(prompt)
                task.wait(2)

                if claimed.Value == player.Name or claimed.Value == player.DisplayName then
                    -- Position slightly back from the prompt but facing the same way
                    hrp.CFrame = pPart.CFrame * CFrame.new(0, 0, 2.5) 
                    say("/e dance2")
                    statusLabel.Text = "Status: Secured & Dancing"
                    sendRichWebhook("Booth Secured", 3066993)
                    return true
                end
            end
        end
    end
    return false
end

--// MAIN EXECUTION
if CONFIG.LowGraphics then
    Lighting.GlobalShadows = false
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("Part") or v:IsA("MeshPart") then v.Material = Enum.Material.SmoothPlastic end
    end
end

sendRichWebhook("Script Initialized", 16777215)

task.spawn(function()
    repeat task.wait() until player:FindFirstChild("leaderstats")
    local raisedStat = player.leaderstats:WaitForChild("Raised")
    lastRaised = raisedStat.Value

    if claimAndPark() then
        while true do
            task.wait(1)
            hopTimer = hopTimer - 1
            
            -- Update UI
            local uptime = os.time() - startTime
            uptimeLabel.Text = string.format("Uptime: %02d:%02d", math.floor(uptime/60), uptime%60)
            timerLabel.Text = string.format("Next Hop: %02d:%02d", math.floor(hopTimer/60), hopTimer%60)
            raisedLabel.Text = "Session Raised: " .. sessionRaised
            
            -- Donation Detection
            if raisedStat.Value > lastRaised then
                local gained = raisedStat.Value - lastRaised
                sessionRaised = sessionRaised + gained
                lastRaised = raisedStat.Value
                hopTimer = CONFIG.Countdown -- Reset hop timer on donation
                
                say(string.format(CONFIG.Messages[math.random(1, #CONFIG.Messages)], gained))
                sendRichWebhook("Donation Received", 16776960, "Gained: **" .. gained .. "**")
                task.wait(1)
                say("/e dance2")
            end
            
            if hopTimer <= 0 then
                serverHop()
                break
            end
        end
    else
        serverHop()
    end
end)

-- Anti-AFK
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)
